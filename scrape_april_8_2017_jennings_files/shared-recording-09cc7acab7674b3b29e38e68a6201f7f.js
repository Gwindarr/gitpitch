Number.prototype.clamp=function(b,a){return Math.min(Math.max(this,b),a)};String.prototype.limitLength=function(b,a){a=a||"\u2026";return this.length<=b?this.substr(0,b):this.substr(0,b-a.length)+a};angular.module("ivpusic.cookie",["ipCookie"]);
angular.module("ipCookie",["ng"]).factory("ipCookie",["$document",function(b){return function(){function a(a,d,e){var g,h,k,l,m,q;if(e=e||{},void 0!==d)return d="object"==typeof d?JSON.stringify(d):d+"","number"==typeof e.expires&&(g=e.expires,e.expires=new Date,-1===g?e.expires=new Date("Thu, 01 Jan 1970 00:00:00 GMT"):void 0!==e.expirationUnit?"hours"===e.expirationUnit?e.expires.setHours(e.expires.getHours()+g):"minutes"===e.expirationUnit?e.expires.setMinutes(e.expires.getMinutes()+g):"seconds"===
e.expirationUnit?e.expires.setSeconds(e.expires.getSeconds()+g):e.expires.setDate(e.expires.getDate()+g):e.expires.setDate(e.expires.getDate()+g)),b[0].cookie=[encodeURIComponent(a),"=",encodeURIComponent(d),e.expires?"; expires="+e.expires.toUTCString():"",e.path?"; path="+e.path:"",e.domain?"; domain="+e.domain:"",e.secure?"; secure":""].join("");e=[];(g=b[0].cookie)&&(e=g.split("; "));g={};q=!1;for(h=0;e.length>h;++h)if(e[h]&&(k=e[h],l=k.indexOf("="),m=k.substring(0,l),d=decodeURIComponent(k.substring(l+
1)),void 0===a||a===m)){try{g[m]=JSON.parse(d)}catch(r){g[m]=d}if(a===m)return g[m];q=!0}return q&&void 0===a?g:void 0}return a.remove=function(c,d){var b=void 0!==a(c);return b&&(d||(d={}),d.expires=-1,a(c,"",d)),b},a}()}]);
hjAppModule.directive("loader",["$rootScope",function(b){return{restrict:"E",replace:!0,scope:{},template:'<div class="notification-box notification-box-loader {{ boxClass }}"><div class="notification-overlay"></div><div class="notification-box-content box-shadow"><div class="spinner"></div><div ng-show="message" class="text">{{ message }}</div></div></div>',link:function(a,c){b.$on("hjLoader",function(b,e,g,h){a.message=e;"show"===g?(a.boxClass="notification-box-visible",h?(c.css("top",h+"px"),c.css("position",
"absolute")):(c.css("top","35%"),c.css("position","fixed"))):a.boxClass=""})}}}]);var ngClipboardDirective=angular.module("ngclipboard",[]),Clipboard=window.Clipboard;
ngClipboardDirective.directive("ngclipboard",["Notify",function(b){return{restrict:"A",scope:{ngclipboardSuccess:"&",ngclipboardError:"&"},link:function(a,c,d){function e(a){var b=$(c),d=b.html();b.html(a);b.attr("disabled","disabled");setTimeout(function(){b.html(d);b.removeAttr("disabled")},1E3)}var g=new Clipboard(c[0]),h=window.UAparser||new UAParser;-1<h.getBrowser().name.indexOf("Safari")&&""===d.ngclipboardHideIfSafari||-1<h.getBrowser().name.indexOf("Safari")&&d.clipboardTarget?c.hide():(g.on("success",
function(c){e("Copied");b.info("Copied to clipboard");a.$apply(function(){a.ngclipboardSuccess({e:c})})}),g.on("error",function(c){a.$apply(function(){a.ngclipboardError({e:c})})}))}}}]);hjAppModule.directive("ngEnter",function(){return function(b,a,c){a.bind("keydown keypress",function(a){13===a.which&&(b.$apply(function(){b.$eval(c.ngEnter,{event:a})}),a.preventDefault())})}});
hjAppModule.directive("ngScrollToWhen",function(){return function(b,a,c){b.$watch(c.ngScrollToWhen,function(c){c&&0<$(a).closest("[ng-scroll-to-when]:visible").length&&(c=$(a).closest("[ng-scroll-to-when]:visible").position().top+$(a).closest("[ng-scroll-container]").scrollTop()-150,$(a).closest("[ng-scroll-container]").animate({scrollTop:c},0))})}});
hjAppModule.directive("notification",["$rootScope","$timeout","SessionStorage",function(b,a,c){var d;return{restrict:"E",replace:!0,scope:{},template:'<div class="notification-box {{ boxClass }}"><div class="close hidden" ng-click="hideCentralNotification()">&times;</div><div class="notification-box-content {{ contentClass }}">{{ message }}</div></div>',link:function(e,g,h){b.$on("hjNotification",function(c,b){e.boxClass="notification-box-visible";e.contentClass=b.cls;e.message=b.message;d&&a.cancel(d);
d=a(function(){e.boxClass="";d=null},b.timeout)});b.$on("hjCentralNotification",function(a,c){e.boxClass="notification-box-central notification-box-visible";e.contentClass=c.cls;e.message=c.message});g=c.get("hjNotification");h=c.get("hjCentralNotification");g&&(c.remove("hjNotification"),b.$emit("hjNotification",g));h&&(c.remove("hjCentralNotification"),b.$emit("hjCentralNotification",h));e.hideCentralNotification=function(){e.boxClass="notification-box-central"}}}}]);
hjAppModule.directive("socialshare",[function(){return{restrict:"E",replace:!0,template:"<a></a>",link:function(b,a,c){a.addClass("icon"===c.type?"btn-icon":"btn");a.addClass("btn-"+c.media);a.addClass("btn-social-"+c.type);a.html('<span class="icon-'+c.media+'"></span><span class="text">'+c.text+"</span>");a.bind("click",function(){shareToSocial(c.media,c.sharetitle,c.sharetext,c.shareurl)})},controller:function(){shareToSocial=function(b,a,c,d){var e=encodeURIComponent(d);d="twitter"===b?300:550;
var g=Math.max(document.documentElement.clientWidth,window.innerWidth||0),h=Math.max(document.documentElement.clientHeight,window.innerHeight||0),g=parseInt(Math.max(g/2-275,0)),h=parseInt(Math.max(h/2-d/2,0));a=encodeURIComponent(a);c=encodeURIComponent(c);switch(b){case "linkedin":b="http://www.linkedin.com/shareArticle?mini=true&url="+e+"&title="+a+"&summary="+c+"&source="+a;break;case "twitter":b="http://twitter.com/share?url="+e+"&text="+c;break;case "facebook":b="http://www.facebook.com/sharer.php?u="+
e;break;default:throw Error("Unknown media: "+b);}window.open(b,"hjShareWindow","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=550, height="+d+", top="+h+", left="+g)}}}}]);hjAppModule.directive("triggerFocus",["$timeout",function(b){return{restrict:"A",link:function(a,c,d){a.$watch(d.triggerFocus,function(){b(function(){c.focus()})})}}}]);
hjAppModule.directive("uiHelper",["$rootScope","$timeout","LocalStorage",function(b,a,c){return{restrict:"E",replace:!0,scope:{},template:'<div id="ui-helper" class="{{ placement }}" style="{{ style }}" ng-show="visible"><div class="close" ng-click="hideAndRemember(identifier);">&times;</div><div class="title"><span class="icon-info blue"></span>{{ title }}</div><p class="message" ng-bind-html="message"></p></div>',link:function(d){function e(){d.visible&&a(function(){d.visible=!1;d.anchor.unbind(".hideEvent")},
0)}function g(a){var c=$('.helper-ui-marker[data-ui-helper-anchor="'+a+'"]');d.identifier===a&&c.remove()}var h,k,l,m,q=null,r;d.hideAndRemember=function(a){d.identifier===a&&(g(a),e(),c.set(a,!0))};b.$on("hjUiHelper",function(b,e,n,w,p,B,s,C){r=B||999998;if(!d.visible||C)d.identifier=e,d.title=n,d.message=w,d.placement=p||"bottom-right",s=s||[0,0],!c.get(e)&&e&&(d.anchor=$("[data-ui-helper-anchor="+e+"]"),h=d.anchor.outerWidth(),k=d.anchor.outerHeight(),l=d.anchor.offset().left,m=d.anchor.offset().top,
d.visible=!0,-1<p.indexOf("bottom")&&(-1<p.indexOf("left")&&(d.style="top: "+(k+m-2+s[0])+"px;left: "+(l-300+h+s[1])+"px;"),-1<p.indexOf("right")&&(d.style="top: "+(k+m-2+s[0])+"px;left: "+(l-5+s[1])+"px;"),d.style+="z-index: "+r+";"),-1<p.indexOf("top")&&a(function(){q=$("#ui-helper").outerHeight();-1<p.indexOf("left")&&(d.style="top: "+(m-k-q+s[0])+"px;left: "+(l-300+h+s[1])+"px;");d.style+="z-index: "+r+";"},0),d.anchor.bind("click.hideEvent",function(){g(e);d.hideAndRemember(e);d.anchor.unbind(".hideEvent")}))});
b.$on("initMarkers",function(){var a,b,d=$(".helper-ui-marker[data-ui-helper-anchor]");_.each(d,function(d){b=$(d);a=b.attr("data-ui-helper-anchor");!c.get(a)&&a&&b.show()})});b.$on("hideHelpers",e);b.$on("$stateChangeStart",e)}}}]);hjAppModule.filter("capitalize",[function(){return function(b){return b?b.replace(/([^\W_]+[^\s-]*) */g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}):""}}]);
hjAppModule.filter("epochDateTime",[function(){return function(b){return"undefined"===typeof b?":":(new Date(1E3*b-6E4*(new Date).getTimezoneOffset())).toISOString().replace("T"," ").slice(0,19)}}]);hjAppModule.filter("epochDate",[function(){return function(b){return"undefined"===typeof b?":":(new Date(1E3*b-6E4*(new Date).getTimezoneOffset())).toISOString().slice(0,10)}}]);
hjAppModule.filter("minutesAndSeconds",[function(){return function(b){var a;if("undefined"===typeof b)return":";a=parseInt(b/1E3,10);b=parseInt(a/60,10);a%=60;a=10>a?"0"+a:a.toString();return b+":"+a}}]);hjAppModule.filter("seconds",[function(){return function(b){return"undefined"===typeof b?"NaN":(b/1E3).toFixed(2)}}]);
hjAppModule.filter("timeAgo",[function(){return function(b){b*=1E3;var a=[[60,"seconds",1],[120,"1 minute ago"],[3600,"minutes",60],[7200,"1 hour ago"],[86400,"hours",3600],[172800,"Yesterday"],[604800,"days",86400]],c=(+new Date-b)/1E3;b=new Date(b-6E4*(new Date).getTimezoneOffset());var d="January February March April May June July August September October November December".split(" ");if(0>=c)return"Just now";if(604800<c)return a=b.getDate(),c=b.getDate(),a+(20<c||10>c?[!1,"st","nd","rd"][c%10]||
"th":"th")+" "+d[b.getMonth()]+" "+(b.getFullYear()!=(new Date).getFullYear()?b.getFullYear():"");for(var e in a)if(b=a[e],c<b[0])return"undefined"==typeof b[2]?b[1]:Math.floor(c/b[2])+" "+b[1]+" ago"}}]);
hjAppModule.filter("stringDateTime",[function(){return function(b){b=new Date(1E3*b-6E4*(new Date).getTimezoneOffset());var a=b.getDate(),c=b.getDate();return a+(20<c||10>c?[!1,"st","nd","rd"][c%10]||"th":"th")+" "+"January February March April May June July August September October November December".split(" ")[b.getMonth()]+" "+b.getFullYear()+" "+b.toISOString().replace("T"," ").slice(11,19)}}]);
hjAppModule.filter("stringDate",[function(){return function(b){b=new Date(1E3*b-6E4*(new Date).getTimezoneOffset());var a=b.getDate(),c=b.getDate();return a+(20<c||10>c?[!1,"st","nd","rd"][c%10]||"th":"th")+" "+"January February March April May June July August September October November December".split(" ")[b.getMonth()]+" "+b.getFullYear()}}]);
hjAppModule.filter("stringMonthDate",[function(){return function(b,a){var c=new Date(1E3*b-6E4*(new Date).getTimezoneOffset()),d="January February March April May June July August September October November December".split(" "),e="Jan. Feb. Mar. Apr. May Jun. Jul. Aug. Sep. Oct. Nov. Dec.".split(" ");return a?e[c.getMonth()]+" "+c.getDate():d[c.getMonth()]+" "+c.getDate()}}]);
hjAppModule.filter("monthName",[function(){return function(b,a){var c="January February March April May June July August September October November December".split(" "),d="Jan. Feb. Mar. Apr. May Jun. Jul. Aug. Sep. Oct. Nov. Dec.".split(" ");return a?d[b]:c[b]}}]);
hjAppModule.filter("osLogo",[function(){return function(b){if(b)return b=b.toLowerCase(),-1<b.indexOf("android")?"icon-android":-1<b.indexOf("blackberry")?"icon-blackberry":-1<b.indexOf("chrome")?"icon-chrome":-1<b.indexOf("ios")||-1<b.indexOf("os x")||-1<b.indexOf("mac")?"icon-apple":-1<b.indexOf("linux")?"icon-linux":-1<b.indexOf("ubuntu")?"icon-ubuntu":-1<b.indexOf("windows")?"icon-microsoft":"icon-unknown-os"}}]);
hjAppModule.filter("browserLogo",[function(){return function(b){if(b)return b=b.toLowerCase(),-1<b.indexOf("android")?"icon-android":-1<b.indexOf("chrome")?"icon-chrome":-1<b.indexOf("chromium")?"icon-chromium":-1<b.indexOf("blackberry")?"icon-blackberry":-1<b.indexOf("firefox")?"icon-firefox":-1<b.indexOf("ie")?"icon-msie":-1<b.indexOf("edge")?"icon-edge":-1<b.indexOf("opera")?"icon-opera":-1<b.indexOf("safari")?"icon-safari":"icon-unknown-browser"}}]);
hjAppModule.filter("device",[function(){return function(b){return"icon-"+b}}]);hjAppModule.service("Audio",[function(){var b={};this.load=function(a){var c;a:{c=navigator.userAgent;var d;for(d=5;11>d;d++)if(0<c.indexOf("MSIE "+d)){c=!0;break a}c=0<c.indexOf("Trident/")}a=c?a+".mp3":a+".wav";"undefined"===typeof b[a]&&(b[a]=new Audio(a));return b[a]}}]);
hjAppModule.service("Crosstab",["ipCookie",function(b){function a(){var a=b("Crosstab")||{},d;for(d in c){var h=a[d],k=c[d];h&&h.lastUpdate!==k.lastUpdate&&(k.lastUpdate=h.lastUpdate,k.callbacks.forEach(function(a){a(h.data)}))}}var c=[],d;this.listen=function(e,g){var h=(b("Crosstab")||{})[e];c[e]=c[e]||{lastUpdate:h&&h.lastUpdate,callbacks:[]};c[e].callbacks.push(g);d||(a(),d=setInterval(a,1E3))};this.signal=function(a,c){var d=b("Crosstab")||{};d[a]={lastUpdate:(new Date).getTime(),data:c};b("Crosstab",
d)};return this}]);hjAppModule.service("Loader",["$rootScope","$timeout",function(b,a){var c=!1,d,e=!1,g=!1;this.show=function(h,k,l){e||g?g=!1:c||(c=!0,k?d=a(function(){b.$emit("hjLoader",h,"show",l)},1E3):b.$emit("hjLoader",h,"show",l))};this.hide=function(){c&&(c=!1,b.$emit("hjLoader",null,"hide",void 0),a.cancel(d))};this.suppress=function(a){if(_.isFunction(a))try{return e=!0,a(arguments)}finally{e=!1}else e=!0,a["finally"](function(){e=!1})};this.suppressOnce=function(){g=!0}}]);
hjAppModule.service("ModalPrompt",[function(){var b=["$scope","$modalInstance","header","text","posButtonText","negButtonText","posCallback","negCallback","posButtonColor","negButtonColor",function(a,c,b,e,g,h,k,l,m,q){a.header=b;a.text=e;a.posButtonText=g;a.negButtonText=h;a.posButtonColor="btn-"+(m||"danger");a.negButtonColor="btn-"+(q||"");a.posClick=function(){a.close();_.isFunction(k)&&k()};a.negClick=function(){a.close();_.isFunction(l)&&l()};a.close=function(){c.close()}}];this.show=function(a,
c,d,e,g,h,k,l){return angular.element("body").injector().get("$modal").open({templateUrl:"modal_prompt.html",controller:b,size:"sm",backdrop:"static",windowClass:"modal-confirm",resolve:{header:function(){return a},text:function(){return c},posButtonText:function(){return d},negButtonText:function(){return e},posCallback:function(){return g},negCallback:function(){return h},posButtonColor:function(){return k},negButtonColor:function(){return l}}})}}]);
hjAppModule.service("Notify",["$rootScope","SessionStorage",function(b,a){function c(c,e,g){var h=g.when||"immediately",k=g.location||"corner";c={message:c,cls:e,timeout:g.timeout||6E3};e={central:"hjCentralNotification",corner:"hjNotification"}[k];if("undefined"===typeof e)throw Error('Bad value "'+k+'" for parameter "location"');if("immediately"===h)b.$emit(e,c);else if("onReload"===h)a.set(e,c);else throw Error('Bad value "'+h+'" for parameter "when"');}this.info=function(a,b){c(a,"notification-box-info",
b||{})};this.success=function(a,b){c(a,"notification-box-success",b||{})};this.error=function(a,b){c(a,"notification-box-error",b||{})};this.unhandledError=function(a){c("Sorry, we could not complete that request.","notification-box-error",a||{})}}]);
(function(){function b(a){return[function(){var c=window[a];return{get:function(a,b){var g=c.getItem(a);return null===g&&"undefined"!==typeof b?b:g?JSON.parse(g):g},set:function(a,b){c.setItem(a,JSON.stringify(b))},remove:function(a){c.removeItem(a)}}}]}hjAppModule.factory("LocalStorage",b("localStorage")).factory("SessionStorage",b("sessionStorage"))})();
hjAppModule.service("Intercom",["$rootScope","$state","Log","UserData",function(b,a,c,d){function e(){jQuery("#intercom-container").remove();_.isFunction(window.Intercom)&&window.Intercom("shutdown")}function g(){var a,c,b;a=function(){a.c(arguments)};a.q=[];a.c=function(c){a.q.push(c)};window.Intercom=a;c=document.createElement("script");c.type="text/javascript";c.async=!0;c.src="https://widget.intercom.io/widget/"+k;c.onload=function(){var a=d.currentSite;a&&(window.Intercom("boot",{app_id:k,email:d.get("userEmail"),
created_at:d.get("userCreated"),name:d.get("userName"),user_id:d.get("userId"),role:d.get("userRole"),receive_product_updates:d.get("subscribeToEmails"),account_type:d.get("accountType"),billing_cycle:d.get("accountBillingCycle"),is_or_was_braintree_customer:d.get("btCustomerId")?!0:!1,bt_next_billing_date:d.get("next_billing_date")||"",account_owner:d.get("isAccountAdmin"),sites:_.map(d.get("sites"),"name").join(", ").slice(0,255),company:{id:a.organization.id,monthly_spend:a.organization.price,
name:a.organization.name,plan:a.organization.plan,created_at:a.organization.created},referral_code:d.get("referralCode"),widget:{activator:".btn-intercom"}}),window.Intercom("reattach_activator"))};b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(c,b)}function h(){clearTimeout(l);l=setTimeout(function(){window.Intercom("update")},m)}var k="insights.hotjar.com"===document.location.host?"c5ke8zbr":"y8w653gn",l,m=3E3;b.$on("$stateChangeSuccess",function(){var c=0<$("#intercom-container").length,
b=!0;d.loggedIn?c||(b=!1,g()):(b=!1,e());-1<a.current.name.indexOf("billing")&&(b=!1,e(),g());b&&h()});this.trackEvent=function(a){d.loggedIn&&_.isFunction(window.Intercom)&&(c.debug("Intercom: Tracking event "+a),window.Intercom("trackEvent",a),h())};this.trackCostChange=function(a,b,e,g){d.loggedIn&&_.isFunction(window.Intercom)&&(c.debug("Intercom: Tracking "+a+" change ("+b+","+e+")"),b!==e&&window.Intercom("trackEvent",(0<g?"Upgraded ":"Downgraded ")+("Plan"===a?"":a+" ")+"to "+e))}}]);
hjAppModule.service("UiHelper",["$rootScope","$timeout",function(b,a){this.show=function(c,d,e,g,h,k,l){a(function(){b.$emit("hjUiHelper",c,d,e,g,h,k,l)},0)};this.hide=function(){b.$emit("hideHelpers")};this.initMarkers=function(){b.$emit("initMarkers")}}]);
hjAppModule.service("URL",["$location",function(b){var a={simple:function(a,b){a=a.split("#")[0].split("?")[0];b=b.split("#")[0].split("?")[0];return a===b},exact:function(a,b){return a===b},starts_with:function(a,b){return 0===a.indexOf(b)},ends_with:function(a,b){return-1!==a.indexOf(b,a.length-b.length)},contains:function(a,b){return-1!==a.indexOf(b)},regex:function(a,b){try{return RegExp(b).test(a)}catch(e){return!1}}};this.getParameter=function(a){return(a=b.search()[a])?a:""};this.getParameterLimitValues=
function(a,b){var e=this.getParameter(a);return-1===b.indexOf(e)?(this.setParameter(a,b[0]),b[0]):e};this.isValid=function(a,b){return b?/^https?:\/\/[^ "]+$/.test(a):/^(http[s]?:\/\/){0,1}(www\.){0,1}[a-zA-Z0-9\.\-]+\.[a-zA-Z]{2,5}[\.]{0,1}/.test(a)};this.normalize=function(a){a=parseUri(a);return(a.protocol||"http")+"://"+a.host+(a.port?":"+a.port:"")+(a.path?a.path:"/")+(a.query?"?"+a.query:"")+(a.anchor?"#"+a.anchor:"")};this.setParameter=function(a,d){b.search(a,d)};this.setParameters=function(a){b.search(a)};
this.match=function(b,d,e){return d&&""!==d?a[e||"contains"](b,d):!1}}]);var hjSharedRecording=angular.module("hjSharedRecording",["restangular","ui.bootstrap","hjAppModule","hjPlaybacksModule","ngSanitize"]);hjAppModule.config(["$locationProvider",function(b){b.html5Mode(!0)}]);
hjSharedRecording.controller("SharedRecordingCtrl",["$rootScope","$scope","$timeout","$interval","$injector","$sce","$modal","$document","$filter","Restangular","Audio","Crosstab","Notify","ipCookie","LocalStorage","SessionStorage","URL","ModalPrompt","$window","Loader","UiHelper",function(b,a,c,d,e,g,h,k,l,m,q,r,u,A,n,w,p,B,s,C,R){function S(f){function b(){var d=f.page_visit_recordings[f.currentPageIndex].events,k=e/f.playbackSpeed,D=!1,t;if(null===f.currentPageOriginalUrl)f.setCurrentIframeUrl(),
m=c(b,k);else if(!l||!window.playbackModuleLoaded)m=c(b,k);else{if(0<=x){for(t=x;t<f.currentPageIndex;t++)K(t,0,f.page_visit_recordings[t].events.length-1);E({command:"clear",data:void 0})}x=-1;f.currentTime+=e;g+=e;f.currentTime=Math.min(f.currentTime,f.duration);for(t=f.processedPosition;t<d.length;t++)if(d[t].time<=g)D=!0,f.currentPosition=t;else break;D&&(K(f.currentPageIndex,f.processedPosition,f.currentPosition),f.processedPosition=f.currentPosition+1);!D&&f.skipPauses&&(k=0);h?(f.pause(),h=
!1):d.length-1<=f.currentPosition?f.currentPageIndex<f.page_visit_recordings.length-1?(f.currentPageIndex+=1,f.currentPosition=-1,f.processedPosition=0,f.setCurrentIframeUrl(),g=0,k?m=c(b,k):(c.cancel(m),b())):a.finishRecording():k?m=c(b,k):(c.cancel(m),b())}}var e=100,g=0,h=!1,l=!1,m;f.currentPageOriginalUrl=null;f.currentPageRewrittenUrl=null;f.currentTime=0;f.currentPageIndex=0;f.currentPosition=0;f.processedPosition=0;f.duration=_.sum(_.map(f.page_visit_recordings,"duration"));f.playbackSpeed=
n.get("playbacksPlaybackSpeed")||1;f.skipPauses=n.get("playbacksSkipPauses")||!1;f.showLoader=!1;f.playing=!1;f.started=!1;f.done=!1;f.page_paths&&(f.start_path=f.page_paths[0]);f.window_size&&(f.window_width=f.window_size[0],f.window_height=f.window_size[1]);f.setCurrentIframeUrl=function(b,c){var d=f.page_visit_recordings[b||f.currentPageIndex],e=p.getParameter("token"),g;a.model.currentPageContentId||(c=!0);a.model.currentPageContentId==d.start_page_content_id&&!c?E({command:"clear",data:void 0}):
(a.model.currentPageContentId=d.start_page_content_id,l=window.playbackModuleLoaded=!1,g="/api/v1/sites/"+z+"/page-content/"+d.start_page_content_id+"/"+d.id+"?_hjt="+(new Date).getTime(),e&&(g+="&token="+e),document.getElementById("preview").contentWindow.location="",document.getElementById("preview").contentWindow.location.replace(g));f.currentPageOriginalUrl=d.url};f.timelineJumpTo=function(a){var b=k,c=(a.target&&a.target.ownerDocument||k).body;null==a.pageX&&null!==a.clientX&&(a.pageX=a.clientX+
(b&&b.scrollLeft||c&&c.scrollLeft||0)-(b&&b.clientLeft||c&&c.clientLeft||0));a.pageX=0>a.pageX?0:a.pageX;a=a.pageX/$("#playback-progress-holder").width();a=parseInt(f.duration*a);f.jumpTo(a)};f.jumpTo=function(d){var k=0;0>d&&(d=0);a.cancelNextRecordingCountdown();f.showLoader=!0;f.done=!1;c.cancel(m);_.each(f.page_visit_recordings,function(a){if(k+a.duration>=d)return f.currentPageIndex=f.page_visit_recordings.indexOf(a),g=d-k,!1;k+=a.duration});for(var l=x=f.currentPageIndex;0<=l;l--)if(f.page_visit_recordings[l].page_content_id){x=
l;break}f.currentTime=d;f.setCurrentIframeUrl(x,!0);f.playing||(f.currentTime>e&&(f.currentTime-=e),h=!0);f.processedPosition=0;f.currentPosition=0;b()};f.setSize=function(){var b=f.window_size[0],d=f.window_size[1],e=(window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth)-(a.model.showSidePanel?330:30),g=(window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight)-136,b=Math.min(e/b,g/d);
a.model.zoom=Math.min(b,1);a.model.zoomedPadding=g/3;a.model.zoomedHeight=(a.model.zoom*d).toFixed(0);a.model.zoomedTop=(g-a.model.zoomedHeight)/2;a.model.zoomCss={display:"block",width:"1px",height:a.model.zoomedHeight+"px",top:a.model.zoomedTop+"px","-ms-transform":"scale("+a.model.zoom+")","-ms-transform-origin":"50% 0 0","-moz-transform":"scale("+a.model.zoom+")","-moz-transform-origin":"50% 0 0","-o-transform":"scale("+a.model.zoom+")","-o-transform-origin":"50% 0 0","-webkit-transform":"scale("+
a.model.zoom+")","-webkit-transform-origin":"50% 0 0",transform:"scale("+a.model.zoom+")","transform-origin":"50% 0 0"};c(function(){a.$apply()})};f.reset=function(){a.model.currentUrl=null;a.model.mouseX=null;a.model.mouseY=null;g=0;f.currentPageOrignalUrl=null;f.currentPageRewrittenUrl=null;f.currentTime=0;f.currentPageIndex=0;f.processedPosition=0;f.currentPosition=0;f.playing=!1;f.started=!1;f.done=!1;f.setCurrentIframeUrl();a.cancelNextRecordingCountdown()};f.play=function(e){var g;a.model.autoNoteHighlight=
!0;a.cancelNextRecordingCountdown();f.playing=!0;f.started=!0;f.done=!1;e&&f.showPlayAnimation();g=d(function(){var a=$("#preview");0!==a.length&&(d.cancel(g),a.on("load",function(){l=!0;f.showLoader=!1}),c.cancel(m),b())},100)};f.pause=function(a){f.playing=!1;c.cancel(m);a&&f.showPauseAnimation()};f.showPauseAnimation=function(){var a=$("#preview-pause");a.show();a.fadeOut(400)};f.showPlayAnimation=function(){var a=$("#preview-play");a.show();a.fadeOut(400)};f.togglePlayPause=function(){a.model.recording.done||
(f.playing?f.pause(!0):f.play(!0))};f.togglePlaybackSpeed=function(){var a=[1,2,4,0.5],d=_.indexOf(a,f.playbackSpeed);f.playbackSpeed=a[(d+1)%a.length];n.set("playbacksPlaybackSpeed",f.playbackSpeed);f.playing&&(c.cancel(m),b())};f.toggleSkipPauses=function(){f.skipPauses=!f.skipPauses;n.set("playbacksSkipPauses",f.skipPauses)};f.rewind=function(){a.model.notesEnabled&&0<f.currentTime&&f.jumpTo(f.currentTime-5E3)}}function T(){m.one("users","me").get().then(function(f){f&&(a.model.user=f)})}function F(a,
b){return G[a]&&G[a][b]?G[a][b]:""}function U(){v.get().then(function(f){var c=f.effective_plan,d=Boolean(H);r.signal("watchingRecording",{recordingId:f.id});a.model.recording=f;a.model.isSharedRecording=d;a.model.showHotjarLogo=d&&"business"!==c;a.model.notesEnabled=!d&&"basic"!==c;S(f);window._hjRecordingData=f;var e;_.each(f.page_visit_recordings,function(a){a.events=_.remove(a.events,function(a){return"tag_recording"!==a.type});a.events=_.sortBy(a.events,"time");a.start_page_content_id=a.page_content_id||
e;e=a.start_page_content_id});a.model.eventMarkers=V(f);a.model.timeLineEvents=_.reject(a.model.eventMarkers,{type:"scroll"});f.setSize();angular.element(s).bind("resize",_.debounce(f.setSize,100,{trailing:!0}));I.getList().then(function(c){a.model.notes=_.map(c,function(a){return{id:a.id,userId:a.user_id,userPictureURL:a.user_picture_url,userName:a.user_name,position:parseFloat(100*(a.time/f.duration)).toFixed(2),time:a.time,type:"note",note:a.note,editMode:!1,showInTimeline:!1}});a.model.recording.play(!1);
a.model.loaded=!0;b.$emit("recordingLoaded")})})}function V(a){var b,c=0,d=null,e=0,g=[];_.each(a.page_visit_recordings,function(h){b=_.filter(h.events,function(a){return _.contains("mouse_click viewport_resize select_change input_choice_change scroll key_press autotag_recording".split(" "),a.type)});e=c;g.push({duration:h.duration,progressPos:parseFloat(100*(e/a.duration)).toFixed(2),time:e,type:"page",url:h.url});_.each(b,function(b){e=c+b.time;b={progressPos:parseFloat(100*(e/a.duration)).toFixed(2),
selector:b.selector,text:b.text,time:e,type:b.type,w:b.w,h:b.h,name:b.name};null!==d&&b.selector!==d.selector&&(d=null);if("key_press"===b.type)if(null===d)d=b;else{d.text=b.text;d.progressDuration=(100*((b.time-d.time)/a.duration)).toFixed(2);return}else if("autotag_recording"===b.type){b.time-=1E3;0>b.time&&(b.time=0);var h=parseFloat(100*(b.time/a.duration)).toFixed(2);b.progressPos=h;b.showInTimeline=!1;b.description=F(b.name,"description");b.text=F(b.name,"name")}g.push(b)});c+=h.duration});
return g}function K(b,c,d){for(var e=window._hjRecordingData.page_visit_recordings[b].events,g,h,k,m=c;m<=d;m++){var l=e[m];W(l.type,l);switch(l.type){case "mouse_move":g=l;break;case "mouse_click":h=l;break;case "viewport_resize":k=l}}g&&(e=g,a.model.mouseX=e.x-24,a.model.mouseY=e.y-22);h&&X.play();k&&"desktop"===a.model.recording.device&&(a.model.recording.window_size=[k.w,k.h],a.model.recording.setSize());E({page:b,fromPosition:c,toPosition:d})}function E(a){document.getElementById("preview").contentWindow.postMessage(a,
"*")}function W(a,b){if(L||-1<M.indexOf(a))"mutation"===a?("undefined"!==typeof b.a&&0<b.a.length&&$.each(b.a,function(a,b){console.debug("MUTATION: Removed node "+b.id);console.debug(window.frames[0].window._hjRecording.pageDom.idMap[b.id])}),"undefined"!==typeof b.b&&0<b.b.length&&$.each(b.b,function(a,b){console.debug("MUTATION: Added or changed node "+b.id);console.debug(window.frames[0].window._hjRecording.pageDom.idMap[b.id]);console.debug(b)}),"undefined"!==typeof b.c&&0<b.c.length&&$.each(b.c,
function(a,b){console.debug("MUTATION: Attribute changed for node "+b.id);console.debug(window.frames[0].window._hjRecording.pageDom.idMap[b.id]);console.debug(b.attributes)}),"undefined"!==typeof b.d&&0<b.d.length&&$.each(b.d,function(a,b){console.debug("MUTATION: Text set for node "+b.id);console.debug(window.frames[0].window._hjRecording.pageDom.idMap[b.id]);console.debug(b.textContent)})):(console.debug(a+": "),console.debug(b))}function J(){return 1===$(".modal-dialog").length}var Y=["$scope",
"isSharedRecording","readOnly","recording",function(a,b,c,d){a.model={isSharedRecording:b,readOnly:c,recording:d}}],z=p.getParameter("site");e=p.getParameter("recording");var H=p.getParameter("token"),X=q.load("/static/playbacks/audio/click"),N,O=!1,v,P,Q,y,I,L=!1,M=[],x=-1;A("recordingListIds")&&(w.set("recordingListIds",A("recordingListIds")),A.remove("recordingListIds"));a.model={autoplay:n.get("playbacksAutoplay")||!0,recording:null,recordingListIds:w.get("recordingListIds",[]),cancelledNextRecordingCountdown:!1,
currentRecordingIndex:-1,currentUrl:null,highlightedNoteId:null,addNoteShouldPlay:!1,draggingProgressHandle:!1,eventMarkers:[],mouseX:null,mouseY:null,newNote:"",notes:[],notesEnabled:!1,autoNoteHighlight:!0,playbackSize:{},shareScreen:!1,showSidePanel:n.get("playbackShowSidePanel",!0),showUserActions:n.get("playbackShowUserActions",!0),sidePanelTab:n.get("playbackSidePanelTab","info"),showHotjarLogo:null,showTagMenu:!1,isSharedRecording:!1,tagField:"",tags:[],timeLineEvents:[],user:null,zoom:1,zoomedHeight:0,
zoomedPadding:0,zoomedTop:0,zoomCss:{display:"inline-block"}};a.model.recordingListIds&&(a.model.currentRecordingIndex=a.model.recordingListIds.indexOf(parseInt(e)));m.setBaseUrl("http://"+location.hostname+(80!=location.port?":"+location.port:"")+"/api/v1");m.addFullRequestInterceptor(function(a,b,c,d,e){e["X-Access-Key"]=A("X-Access-Key");return{headers:e}});m.setErrorInterceptor(function(b){if(403===b.status||404===b.status||500===b.status)a.model.loaded=!0,a.showRecordingUnavailable(b.status)});
H&&m.setDefaultRequestParams({token:H});"all"===p.getParameter("debug")?L=!0:p.getParameter("debug").length&&(M=p.getParameter("debug").split(","));!z||!e?a.model.loaded=!0:(q=m.one("sites",z),v=q.one("recordings",e),P=q.one("recordings"),I=v.all("notes"),T(),U());r.listen("recordingDeleted",function(b){var d=angular.copy(a.model.recordingListIds),d=_.remove(d,function(a){return a!==b.recordingId});O?a.hasNextRecording()?(w.set("recordingListIds",d),c(function(){C.show("Loading next recording...")},
0),c(function(){a.nextRecording()},2E3)):a.closeWindow():b.recordingId!==a.model.recording.id?(a.model.recordingListIds=d,w.set("recordingListIds",d)):a.closeWindow()});var Z=["$scope","errorCode",function(a,b){a.model={errorCode:b}}],aa=["$scope","recording","toggleRecordingShare",function(a,b,c){a.model={recording:b};a.toggleRecordingShare=c;a.closeModal=function(){a.$close()}}],G={madmouse:{name:"mad mouse",description:"Fast, seemingly random mouse movement"},rageclick:{name:"rage click",description:"Repeated frustrated clicks"},
wildscroll:{name:"wild scroll",description:"Scrolling up and down in frustration"},uturn:{name:"u-turn",description:"Moving back and forth between pages"}};a.readOnly=function(){if(a.model.recording)return"write"!==a.model.recording.user_access&&"admin"!==a.model.recording.user_access};a.progressHandleDown=function(){k.on("mousemove",a.progressHandleDrag);k.on("mouseup",a.progressHandleDrop)};a.progressHandleDrop=function(b){b.stopPropagation();a.model.recording.timelineJumpTo(b);a.model.draggingProgressHandle=
!1;k.unbind("mousemove",a.progressHandleDrag);k.unbind("mouseup",a.progressHandleDrop)};a.progressHandleDrag=function(b){var c=k,d=(b.target&&b.target.ownerDocument||k).body,e=$("#playback-progress-holder").outerWidth();a.model.draggingProgressHandle=!0;null==b.pageX&&null!==b.clientX&&(b.pageX=b.clientX+(c&&c.scrollLeft||d&&d.scrollLeft||0)-(c&&c.clientLeft||d&&d.clientLeft||0));b.pageX-=8;5>b.pageX&&(b.pageX=4);b.pageX>e&&(b.pageX=e);$("#playback-progress-handle").css({left:b.pageX})};a.showRecordingUnavailable=
function(a){h.open({templateUrl:"modal_recording_unavailable.html",controller:Z,backdrop:"static",windowClass:"modal-400 modal-recording-unavailable",resolve:{errorCode:function(){return a}}})};a.showShareRecording=function(b){J()||(a.model.recording.playing&&a.model.recording.pause(!0),h.open({templateUrl:"modal_share_recording.html",windowClass:"modal-600 modal-share-recording",controller:aa,resolve:{recording:function(){return b},toggleRecordingShare:function(){return a.toggleRecordingShare}}}))};
a.toggleRecordingFavourite=function(a){a.customPOST({action:"toggle_favourite"}).then(function(b){b.success?(a.favourite=!a.favourite,r.signal("toggleFavourite",{recordingId:a.id,value:a.favourite})):alert("Could not toggle favourite.")})};a.toggleRecordingShare=function(a){a.customPOST({action:"toggle_shared"}).then(function(b){b.success?r.signal("toggleShared",{recordingId:a.id,value:a.shared}):(a.shared=!a.shared,alert("Could not toggle recording sharing."))})};a.deleteRecording=function(b){J()||
(a.model.recording.playing&&a.model.recording.pause(!0),B.show("Delete recording?","Deleting a recording is permanent and cannot be undone.","Yes, delete","Cancel",function(){P.customPOST({action:"bulk_delete",recording_ids:[b.id]}).then(function(a){a.success?(O=!0,r.signal("recordingDeleted",{recordingId:b.id})):u.error("Could not delete recording.")})}))};a.toggleSidePanel=function(b){b?(a.model.showSidePanel=!0,a.model.sidePanelTab=b):a.model.showSidePanel=!a.model.showSidePanel;a.model.recording.setSize();
n.set("playbackShowSidePanel",a.model.showSidePanel);n.set("playbackSidePanelTab",a.model.sidePanelTab)};a.onNoteTextChange=function(){a.model.recording.playing&&(a.model.addNoteShouldPlay=a.model.recording.playing,a.model.recording.pause(!0))};a.addNote=function(){a.model.newNote.length&&I.post({note:a.model.newNote,time:a.model.recording.currentTime,user_id:a.model.user.user_id}).then(function(b){b.success?(a.model.notes.push({id:b.note_id,userId:a.model.user.user_id,userPictureURL:a.model.user.user_picture_url,
userName:a.model.user.user_name,position:parseFloat(100*(a.model.recording.currentTime/a.model.recording.duration)).toFixed(2),time:a.model.recording.currentTime,type:"note",note:a.model.newNote,editMode:!1,showInTimeline:!1}),a.model.newNote="",u.success("Note added."),$("#note-field").blur()):u.unhandledError()});a.model.addNoteShouldPlay&&a.model.recording.play(!0)};a.editNote=function(a){a.editMode=!0};a.saveNote=function(a){y=v.one("notes",a.id);y.note=a.note;y.time=a.time;y.put().then(function(){a.editMode=
!1;u.success("Note updated.")})};a.deleteNote=function(b){B.show("Delete note?","Deleting notes is permanent and cannot be undone.","Yes, delete","Cancel",function(){y=v.one("notes",b.id);y.remove().then(function(){a.model.notes=_.reject(a.model.notes,function(a){return a.id===b.id});u.info("Note deleted.")})})};a.showNoteInTimeline=function(a){a.showInTimeline=!0};a.hideNoteInTimeline=function(a){a.showInTimeline=!1};a.highlightNoteField=function(){var b=$("#add-note-container"),d=b.find("textarea");
a.model.notesEnabled&&(a.toggleSidePanel("events"),b.addClass("highlight"),a.onNoteTextChange(),c(function(){d.focus()},0),c(function(){b.removeClass("highlight")},3E3))};a.highlightTagField=function(){var b=$("#tag-input");a.toggleSidePanel("info");b.addClass("highlight");c(function(){b.focus()},0);c(function(){b.removeClass("highlight")},3E3)};a.isTagAdded=function(b){return-1<a.model.recording.tags.indexOf(b)};a.removeTag=function(b){Q=v.one("tags",b);Q.remove().then(function(){a.model.recording.tags=
_.filter(a.model.recording.tags,function(a){return a!==b});r.signal("removeTag",{recordingId:a.model.recording.id,tagName:b})})};a.addTag=function(b){v.customPOST({action:"add_tag",name:b}).then(function(){a.model.recording.tags.push(b);r.signal("addTag",{recordingId:a.model.recording.id,tagName:b});_.contains(a.model.recording.available_tag_names,b)||a.model.recording.available_tag_names.push(b)})};a.toggleTag=function(b){_.contains(a.model.recording.tags,b)?a.removeTag(b):a.addTag(b)};a.resetTagField=
function(){a.model.tagField=""};a.showTagMenu=function(){a.model.showTagMenu=!0};a.hideTagMenu=function(){a.model.showTagMenu=!1};a.toggleUserActions=function(){n.set("playbackShowUserActions",a.model.showUserActions)};a.getNotesAndEvents=function(){return _.sortBy(a.model.timeLineEvents.concat(a.model.notes),"time")};a.closeWindow=function(){window.close()};a.toggleAutoplay=function(){a.model.autoplay=!a.model.autoplay;n.set("playbacksAutoplay",a.model.autoplay);a.model.autoplay||a.cancelNextRecordingCountdown()};
a.disableAutoplay=function(){a.model.autoplay=!1;n.set("playbacksAutoplay",a.model.autoplay);a.cancelNextRecordingCountdown()};a.hasNextRecording=function(){var b=a.model.recordingListIds[a.model.currentRecordingIndex+1];if(a.model.recording)return b&&-1<a.model.currentRecordingIndex&&!a.model.isSharedRecording};a.hasPreviousRecording=function(){var b=a.model.recordingListIds[a.model.currentRecordingIndex-1];if(a.model.recording)return b&&-1<a.model.currentRecordingIndex&&!a.model.isSharedRecording};
a.nextRecording=function(){window.location.href="http://"+location.host+"/p?site="+z+"&recording="+a.model.recordingListIds[a.model.currentRecordingIndex+1]};a.previousRecording=function(){window.location.href="http://"+location.host+"/p?site="+z+"&recording="+a.model.recordingListIds[a.model.currentRecordingIndex-1]};a.finishRecording=function(){a.model.recording.done=!0;a.model.recording.pause();a.model.cancelledNextRecordingCountdown=!1;a.hasNextRecording()&&(a.model.autoplay&&!a.model.isSharedRecording)&&
(N=c(function(){a.nextRecording()},7500))};a.cancelNextRecordingCountdown=function(){a.model.cancelledNextRecordingCountdown=!0;c.cancel(N)};a.tagFieldEnter=function(){0===l("filter")(a.model.recording.available_tag_names,a.model.tagField,!1).length&&(a.addTag(a.model.tagField),a.resetTagField(),a.hideTagMenu())};a.getCleanSelector=function(a){return a&&a.split(":")[1].replace(/\\/g,"")};a.getEventDescription=function(b,c){var d;if(a.model.recording){switch(b){case "input_choice_change":case "key_press":case "select_change":d=
"Typing / Changed field value";break;case "mouse_click":d="desktop"===a.model.recording.device?"Mouse click":"Tap";break;case "scroll":d="Page scroll";break;case "page":d="Visited new page";break;case "viewport_resize":d="Resized window";break;case "autotag_recording":d=F(c,"name")}return d}};a.showHelpModal=function(){J()||(a.model.recording.playing&&a.model.recording.pause(!0),h.open({templateUrl:"modal_help.html",windowClass:"modal-700 modal-help",controller:Y,resolve:{isSharedRecording:function(){return a.model.isSharedRecording},
readOnly:function(){return a.readOnly()},recording:function(){return a.model.recording}}}))};k.bind("click",function(b){0<angular.element("#tag-filter").find(b.target).length||a.$apply(function(){a.model.showTagMenu=!1})});b.$on("recordingLoaded",function(){R.show("uihelper_recordingShortcuts","Keyboard shortcuts","Use the recording player more efficiently by using keyboard shortcuts.","top-left",999999999,[16,12]);Mousetrap.bind("space",function(){c(a.model.recording.togglePlayPause,0);return!1});
Mousetrap.bind("i",function(){c(a.model.recording.togglePlaybackSpeed,0);return!1});Mousetrap.bind("o",function(){c(a.model.recording.toggleSkipPauses,0);return!1});Mousetrap.bind("r",function(){c(function(){a.model.recording.reset();a.model.recording.play()},0);return!1});Mousetrap.bind("123456789".split(""),function(b,c){var d=a.model.recording.duration/10*parseInt(c);a.model.recording.jumpTo(d);return!1});Mousetrap.bind("h",function(){a.toggleSidePanel();return!1});Mousetrap.bind("?",function(){a.showHelpModal();
return!1});a.model.isSharedRecording||(Mousetrap.bind("shift+left",function(){a.hasPreviousRecording()?a.previousRecording():c(function(){u.info("No previous recording available.")},0);return!1}),Mousetrap.bind("shift+right",function(){a.hasNextRecording()?a.nextRecording():c(function(){u.info("No next recording available.")},0);return!1}),Mousetrap.bind("p",function(){c(a.toggleAutoplay,0);return!1}),a.readOnly()||(Mousetrap.bind("t",function(){a.highlightTagField();return!1}),Mousetrap.bind("n",
function(){c(a.highlightNoteField,0);return!1}),Mousetrap.bind("d",function(){a.deleteRecording(a.model.recording);return!1}),Mousetrap.bind("f",function(){c(function(){u.info(a.model.recording.favourite?"Recording not starred":"Recording starred")},0);a.toggleRecordingFavourite(a.model.recording);return!1}),Mousetrap.bind("s",function(){a.showShareRecording(a.model.recording);return!1})))})}]);
